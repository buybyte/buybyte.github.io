<!doctype html><html lang=en><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge,chrome=1"><title>Master Iptables - buybyte</title><meta name=renderer content="webkit"><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=cache-control content="no-transform"><meta http-equiv=cache-control content="no-siteapp"><meta name=theme-color content="#f8f5ec"><meta name=msapplication-navbutton-color content="#f8f5ec"><meta name=apple-mobile-web-app-capable content="yes"><meta name=apple-mobile-web-app-status-bar-style content="#f8f5ec"><meta name=author content="buybyte"><meta name=description content="数据包 接收 发送 转发 路由器 iptables 三要素 table tables allow you to do very specific things with packets. 对数据包做特定的处理 filter table default mangle table nat table raw table chain each of these tables are composed of a few default chains. These chains allow you to filter packets at various points. PREROUTING INPUT"><meta name=keywords content="Hugo,theme,even"><meta name=generator content="Hugo 0.119.0 with theme even"><link rel=canonical href=http://buybyte.github.io/2025/01/07/master-iptables/><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=manifest href=/manifest.json><link rel=mask-icon href=/safari-pinned-tab.svg color=#5bbad5><link href=/sass/main.min.f92fd13721ddf72129410fd8250e73152cc6f2438082b6c0208dc24ee7c13fc4.css rel=stylesheet><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.css integrity="sha256-7TyXnr2YU040zfSP+rEcz29ggW4j56/ujTPwjMzyqFY=" crossorigin=anonymous><meta property="og:title" content="Master Iptables"><meta property="og:description" content="数据包 接收 发送 转发 路由器 iptables 三要素 table tables allow you to do very specific things with packets. 对数据包做特定的处理 filter table default mangle table nat table raw table chain each of these tables are composed of a few default chains. These chains allow you to filter packets at various points. PREROUTING INPUT"><meta property="og:type" content="article"><meta property="og:url" content="http://buybyte.github.io/2025/01/07/master-iptables/"><meta property="article:section" content="post"><meta property="article:published_time" content="2025-01-07T11:15:57+08:00"><meta property="article:modified_time" content="2025-01-07T11:15:57+08:00"><meta itemprop=name content="Master Iptables"><meta itemprop=description content="数据包 接收 发送 转发 路由器 iptables 三要素 table tables allow you to do very specific things with packets. 对数据包做特定的处理 filter table default mangle table nat table raw table chain each of these tables are composed of a few default chains. These chains allow you to filter packets at various points. PREROUTING INPUT"><meta itemprop=datePublished content="2025-01-07T11:15:57+08:00"><meta itemprop=dateModified content="2025-01-07T11:15:57+08:00"><meta itemprop=wordCount content="607"><meta itemprop=keywords content><meta name=twitter:card content="summary"><meta name=twitter:title content="Master Iptables"><meta name=twitter:description content="数据包 接收 发送 转发 路由器 iptables 三要素 table tables allow you to do very specific things with packets. 对数据包做特定的处理 filter table default mangle table nat table raw table chain each of these tables are composed of a few default chains. These chains allow you to filter packets at various points. PREROUTING INPUT"><!--[if lte IE 9]><script src=https://cdnjs.cloudflare.com/ajax/libs/classlist/1.1.20170427/classList.min.js></script><![endif]--><!--[if lt IE 9]><script src=https://cdn.jsdelivr.net/npm/html5shiv@3.7.3/dist/html5shiv.min.js></script>
<script src=https://cdn.jsdelivr.net/npm/respond.js@1.4.2/dest/respond.min.js></script><![endif]--></head><body><div id=mobile-navbar class=mobile-navbar><div class=mobile-header-logo><a href=/ class=logo>keep writing</a></div><div class=mobile-navbar-icon><span></span>
<span></span>
<span></span></div></div><nav id=mobile-menu class="mobile-menu slideout-menu"><ul class=mobile-menu-list><a href=/><li class=mobile-menu-item>Home</li></a><a href=/post/><li class=mobile-menu-item>Archives</li></a><a href=/tags/><li class=mobile-menu-item>Tags</li></a><a href=/categories/><li class=mobile-menu-item>Categories</li></a><a href=/2022/03/27/about/><li class=mobile-menu-item>About</li></a></ul></nav><div class=container id=mobile-panel><header id=header class=header><div class=logo-wrapper><a href=/ class=logo>keep writing</a></div><nav class=site-navbar><ul id=menu class=menu><li class=menu-item><a class=menu-item-link href=/>Home</a></li><li class=menu-item><a class=menu-item-link href=/post/>Archives</a></li><li class=menu-item><a class=menu-item-link href=/tags/>Tags</a></li><li class=menu-item><a class=menu-item-link href=/categories/>Categories</a></li><li class=menu-item><a class=menu-item-link href=/2022/03/27/about/>About</a></li></ul></nav></header><main id=main class=main><div class=content-wrapper><div id=content class=content><article class=post><header class=post-header><h1 class=post-title>Master Iptables</h1><div class=post-meta><span class=post-time>2025-01-07</span>
<span class=more-meta>607 words</span>
<span class=more-meta>2 mins read</span></div></header><div class=post-toc id=post-toc><h2 class=post-toc-title>Contents</h2><div class="post-toc-content always-active"><nav id=TableOfContents><ul><li><a href=#数据包>数据包</a></li><li><a href=#iptables-三要素>iptables 三要素</a><ul><li><a href=#table>table</a><ul><li><a href=#filter-table-default>filter table <code>default</code></a></li><li><a href=#mangle-table>mangle table</a></li><li><a href=#nat-table>nat table</a></li><li><a href=#raw-table>raw table</a></li></ul></li><li><a href=#chain>chain</a><ul><li><a href=#prerouting>PREROUTING</a></li><li><a href=#input>INPUT</a></li><li><a href=#output>OUTPUT</a></li><li><a href=#forward>FORWARD</a></li><li><a href=#postrouting>POSTROUTING</a></li></ul></li><li><a href=#target>target</a><ul><li><a href=#terminating-target>terminating target</a></li><li><a href=#non-terminating-target>non-terminating target</a></li></ul></li><li><a href=#iptables-examples>iptables examples</a><ul><li><a href=#list-rules>list rules</a></li><li><a href=#append-rules>append rules</a></li><li><a href=#delete-rules>delete rules</a></li><li><a href=#insertreplace-rules>insert/replace rules</a></li><li><a href=#protocalsmodules>protocals/modules</a></li><li><a href=#connection-tracking-module>connection tracking module</a></li><li><a href=#change-default-policy>change default policy</a></li><li><a href=#custom-chain>custom chain</a></li></ul></li><li><a href=#默认的-iptables-配置>默认的 iptables 配置</a></li></ul></li><li><a href=#references>References</a></li></ul></nav></div></div><div class=post-content><h1 id=数据包>数据包</h1><ol><li>接收</li><li>发送</li><li>转发 <code>路由器</code></li></ol><h1 id=iptables-三要素>iptables 三要素</h1><h2 id=table>table</h2><blockquote><p>tables allow you to do very <code>specific things</code> with packets. 对数据包做特定的处理</p></blockquote><h3 id=filter-table-default>filter table <code>default</code></h3><h3 id=mangle-table>mangle table</h3><h3 id=nat-table>nat table</h3><h3 id=raw-table>raw table</h3><h2 id=chain>chain</h2><blockquote><p>each of these tables are <code>composed of a few default chains</code>. These chains allow you to <code>filter</code> packets at <code>various points</code>.</p></blockquote><h3 id=prerouting>PREROUTING</h3><h3 id=input>INPUT</h3><h3 id=output>OUTPUT</h3><h3 id=forward>FORWARD</h3><h3 id=postrouting>POSTROUTING</h3><h2 id=target>target</h2><h3 id=terminating-target>terminating target</h3><ol><li>一旦匹配立刻决定一个网络包的最终命运。如 <code>ACCEPT</code>,<code>DROP</code>,<code>REJECT</code></li><li>chain 上的 target 依次匹配, 一旦匹配就执行关联的操作。匹配不到执行默认的 target</li><li>可以配置 default policy, 也是一个 target</li><li>所有 chain 的 default policy 是 <code>ACCEPT</code></li></ol><h3 id=non-terminating-target>non-terminating target</h3><ol><li>如 <code>LOG</code> 记录 kernel 日志</li></ol><h2 id=iptables-examples>iptables examples</h2><blockquote><p>-t 不指定，默认是 filter table. 为啥? filter 常用呗</p></blockquote><p><em>N</em>ew-chain
<em>X</em>delete-chain
<em>L</em>ist
<em>I</em>nsert
<em>A</em>ppend
<em>D</em>elete
<em>R</em>eplace
<em>F</em>lush
<em>P</em>olicy
<em>j</em>ump
<em>m</em>atch <em>m</em>odule
<em>s</em>ource
<em>d</em>estination
<em>n</em>umeric 不进行 reverse dns lookup
<em>p</em>rotocol
<em>i</em>nput interface
<em>o</em>nput interface</p><h3 id=list-rules>list rules</h3><ol><li><p>iptables -L &ndash;line-numbers</p></li><li><p>iptables -A INPUT -p tcp &ndash;dport 22 -j LOG</p></li><li><p>iptables -D INPUT -p tcp &ndash;dport 22 -j LOG</p></li></ol><h3 id=append-rules>append rules</h3><ol><li>iptables <code>-A</code> INPUT -s 221.194.47.0/24 -j REJECT</li></ol><h3 id=delete-rules>delete rules</h3><ol><li>iptables <code>-D</code> INPUT -s 221.194.47.0/24 -j REJECT</li><li>iptables -D INPUT <code>12</code></li><li>iptables -D INPUT <code>9</code></li><li>iptables -F</li><li>iptables -F INPUT</li></ol><h3 id=insertreplace-rules>insert/replace rules</h3><ol><li>iptables -I INPUT 1 -s 114.114.114.114 -j ACCEPT</li><li>iptables -R INPUT 1 -s 59.45.175.10 -J ACCEPT</li></ol><h3 id=protocalsmodules>protocals/modules</h3><ol><li>iptables -A INPUT -p tcp -m tcp -dport 22 -s 59.45.175.0/24 -j DROP</li><li>iptables -A INPUT -p tcp -m multiport -dports 22,49101 -s 59.45.175.0/24 -j DROP</li><li>iptables -A input -p icmp -m icmp -icmp-type 17 -j DROP</li></ol><h3 id=connection-tracking-module>connection tracking module</h3><h3 id=change-default-policy>change default policy</h3><ol><li>iptables -P INPUT DROP</li><li>iptables -t nat -P INPUT DROP</li></ol><h3 id=custom-chain>custom chain</h3><ol><li>iptables -N ssh-rules</li><li>iptables -A ssh-rules -s 18.130.0.0./16 -j ACCEPT</li><li>iptables -A ssh-rules -s 18.11.0.0/16 -j ACCEPT</li><li>iptables -A ssh-rules -j DROP</li><li>iptables -A INPUT -p tcp -m tcp &ndash;dport 22 -j <code>ssh-rules</code></li></ol><h2 id=默认的-iptables-配置>默认的 iptables 配置</h2><blockquote><p>所有 chain 的默认 policy 都是 ACCEPT</p></blockquote><pre><code class=language-bash>[root@node96 ~]# iptables -t filter -L -n --line-numbers
Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
num  target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination 

[root@node96 ~]# iptables -t nat -L -n --line-numbers
Chain PREROUTING (policy ACCEPT)
num  target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
num  target     prot opt source               destination

[root@node96 ~]# iptables -t mangle -L -n --line-numbers
Chain PREROUTING (policy ACCEPT)
num  target     prot opt source               destination         

Chain INPUT (policy ACCEPT)
num  target     prot opt source               destination         

Chain FORWARD (policy ACCEPT)
num  target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination         

Chain POSTROUTING (policy ACCEPT)
num  target     prot opt source               destination 

[root@node96 ~]# iptables -t raw -L -n --line-numbers
Chain PREROUTING (policy ACCEPT)
num  target     prot opt source               destination         

Chain OUTPUT (policy ACCEPT)
num  target     prot opt source               destination 
</code></pre><h1 id=references>References</h1><ol><li><a href=https://www.booleanworld.com/depth-guide-iptables-linux-firewall/>depth-guide-iptables-linux-firewall-强烈推荐</a></li><li><a href=https://mp.weixin.qq.com/s/O084fYzUFk7jAzJ2DDeADg>iptables-解析</a></li><li><a href=https://man7.org/linux/man-pages/man8/iptables.8.html>iptables</a></li><li><a href=https://man7.org/linux/man-pages/man8/iptables-extensions.8.html>iptables-extensions</a></li><li><a href=https://www.linode.com/docs/guides/linux-router-and-ip-forwarding/#enable-ip-forwarding>ip-forward</a></li><li><a href=https://manned.org/iptables>https://manned.org/iptables</a></li></ol></div><div class=post-copyright><p class=copyright-item><span class=item-title>Author</span>
<span class=item-content>buybyte</span></p><p class=copyright-item><span class=item-title>LastMod</span>
<span class=item-content>2025-01-07</span></p><p class=copyright-item><span class=item-title>Markdown</span>
<span class=item-content><a class=link-to-markdown href=http://buybyte.github.io/2025/01/07/master-iptables/index.md target=_blank>The Markdown version »</a></span></p></div><footer class=post-footer><nav class=post-nav><a class=prev href=/2025/01/10/lsof-examples/><i class="iconfont icon-left"></i>
<span class="prev-text nav-default">lsof examples</span>
<span class="prev-text nav-mobile">Prev</span></a>
<a class=next href=/2025/01/06/my-source-list/><span class="next-text nav-default">My Source List</span>
<span class="next-text nav-mobile">Next</span>
<i class="iconfont icon-right"></i></a></nav></footer></article></div><script src=https://utteranc.es/client.js repo=buybyte/blog-comments issue-term=pathname theme=github-light crossorigin=anonymous async></script><noscript>Please enable JavaScript to view the <a href=https://github.com/utterance>comments powered by utterances.</a></noscript></div></main><footer id=footer class=footer><div class=social-links><a href=mailto:aoyunyoung@gmail.com class="iconfont icon-email" title=email></a>
<a href=https://stackoverflow.com/users/9112817/cloud-young class="iconfont icon-stack-overflow" title=stack-overflow></a>
<a href=https://github.com/buybyte class="iconfont icon-github" title=github></a>
<a href=http://buybyte.github.io/index.xml type=application/rss+xml class="iconfont icon-rss" title=rss></a></div><div class=copyright><span class=power-by>Powered by <a class=hexo-link href=https://gohugo.io>Hugo</a></span>
<span class=division>|</span>
<span class=theme-info>Theme -
<a class=theme-link href=https://github.com/olOwOlo/hugo-theme-even>Even</a></span>
<span class=copyright-year>&copy;
2019 -
2025<span class=heart><i class="iconfont icon-heart"></i></span><span>buybyte</span></span></div></footer><div class=back-to-top id=back-to-top><i class="iconfont icon-up"></i></div></div><script src="/lib/highlight/highlight.pack.js?v=20171001"></script>
<script src=https://cdn.jsdelivr.net/npm/jquery@3.2.1/dist/jquery.min.js integrity="sha256-hwg4gsxgFZhOsEEamdOYGBf13FyQuiTwlAQgxVSNgt4=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/slideout@1.0.1/dist/slideout.min.js integrity="sha256-t+zJ/g8/KXIJMjSVQdnibt4dlaDxc9zXr/9oNPeWqdg=" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3.1.20/dist/jquery.fancybox.min.js integrity="sha256-XVLffZaxoWfGUEbdzuLi7pwaUJv1cecsQJQqGLe7axY=" crossorigin=anonymous></script>
<script type=text/javascript src=/js/main.min.4ae89da218555efa0e7093a20b92017d2e1202b66fff9fc2edf4cb8d44b44c6e.js></script></body></html>